<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Family Board setup</title>
    <link rel="stylesheet" type="text/css" href="css/setup.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="js/setup.js"></script>
    <script>
        function persist() {
            let calNames = $('input[name="name[]"]').map(function() { return $(this).val(); });
            let aliases = $('input[name="alias[]"]').map(function() { return $(this).val(); });

            let calendars = [];
            for (i = 0; i < calNames.length; i++) {
                let cn = calNames[i];
                let al = aliases[i];

                if(cn.length > 0 || al.length > 0) {
                    calendars.push({
                        name: cn,
                        alias: al
                    });
                }
            }

            if (calendars.length == 0) {
                localStorage.removeItem('calendars');
                return false;
            }

            localStorage.setItem('calendars', JSON.stringify(calendars));
            return true;
        }

        $(document).ready( function() {
            $('#calendarsform').submit(function() {
                return persist(); // return false to cancel form action
            });


            var reset_button    = $(".btn-reset");
            var save_button    = $(".btn-save");
            var wrapper         = $(".calendars"); //Fields wrapper
            var add_button      = $(".add_field_button"); //Add button ID

            $(reset_button).click(function(e){ //on add input button click
                e.preventDefault();
                window.location.reload();
            });

            $(save_button).click(function(e){ //on save input button click
                e.preventDefault();
                persist();
                window.location.href = "index.html";
            });

            $(add_button).click(function(e){ //on add input button click
                e.preventDefault();
                $(wrapper).append(renderCalendarSetup(true)); //add input box
            });

            $(wrapper).on("click",".remove_field", function(e){ //user click on remove text
                e.preventDefault(); $(this).parent('fieldset').remove();
            });

            let calendars = JSON.parse(localStorage.getItem('calendars'));
            let calendarsHtml = calendars.map(cal => renderCalendarSetup(true, cal));
            $(wrapper).append(calendarsHtml);
        });
    </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-89452938-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body>
<div class="main">
    <div class="title">
        Google Family Board configuration
    </div>
    <div class="description">
        Google Family Board uses your Google Calendar to build a week calendar board of multiple calendars.</br>
    </div>
    <div class="subtitle">Get started</div>
    <div>
        <ol>
            <li>On the <a href="index.html">family board</a> you must sign in with a Google account, if prompted.</li>
            <li>Share the calendars, you want to show in the family board, with the Google account you signed in with.</li>
            <li>Add/specify which calendars you want to have displayed on the <a href="index.html">family board</a> and press "Save".</li>
        </ol>
    </div>
    <div class="subtitle">Calendars <button class="add_field_button">Add calendar</button></div>
    <div class="calendars">

    </div>
    <div class="buttons">
        <input class="btn-save" type="button" value="Save" /><input class="btn-reset" type="button" value="Reset"/>
    </div>
</div>
</body>
</html>

